# A minimal Spring Boot project using Kotlin scripting

## Introduction

Running Kotlin scripts inside Spring Boot applications is a cool thing.

But it is very tricky to make it work inside SpringBoot fatjars.

## The problem
Kotlin cannot load classes from the fatjars.

Theoretically, a classloader can be configured for Kotlin scripting.

Unfortunately, this doesn't actually work because the implementation uses its own classloader.

## The solution
The workaround is to unpack the jars used by the scripts.

## Motivation
Kotlin scripts in my application for evaluations etc. are a powerful option.
Scripts can be adapted at runtime.
But please note: scripts must be well secured because they may have full access to the application.

## State of the art (call for improvements)
I tried several approaches:
- passing my own classLoader (doesn't work)
- unpacking jars in the SpringBoot fatjar (does work), and
- automatically copying jars from the fatjar to the local file system (will follow).
I will show all approaches here and call for improvements.

## Gradle vs. Maven
I migrated my project (ProjectForge) from *Maven* to *Gradle*. In principle, unpacking fatjars with maven is also possible, but it is incredibly more complicated.

After a few hours I decided to invest the time in migrating to Gradle. This was also time-consuming, but it paid off in the end.

## This project
This project contains sample code including a gradle setup that implements a minimal project with these requirements.

### Module: application
The Spring Boot application with gradle configuration to unpack the jars.

The current solution:

- Variables can be passed. This is useful, for example, if users are required in ThreadLocal for the user authentication of application functions used.
- The script is automatically stopped after a defined runtime. This avoids endless scripts or unwanted long-running scripts.

### Module: business
A simple module with a class that is used by the Kotlin script.

## How to run
Just run:

1. `./gradlew clean build`
2. `java -jar application/build/libs/application-0.0.1.jar`
3. See the output in the console.
